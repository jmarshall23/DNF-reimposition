/*******************************************************************************
 * Electronics_Generic_Clock generated by Eliot.UELib using UELib.CLI.
 * Eliot.UELib Â© 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class Electronics_Generic_Clock extends Electronics_Generic
	abstract
	collapsecategories;

struct STimeOverride
{
	var() int Hour;
	var() int Minute;
	var() int Second;
};

var() noexport bool bPoweredOn "Whether this clock is currently 'on' or not.";
var() noexport bool bTimeOverride "Set this to true when you want to override the time the clock displays. Otherwise it will display the current actual time of the player's computer.";
var() noexport STimeOverride TimeOverride "Values to override the actual time with when bTimeOverride is set.";
var() noexport int NumHours "Ability to specify the number of hours displayed on the clock (alien clocks?).";
var() noexport int NumMinutes "Number of minutes in an hour displayed on the clock.";
var() noexport int NumSeconds "Number of seconds in a minute displayed on the clock.";
var() noexport float UpdateRate "How frequently the clock should update. If bSmoothMotion is false, this is how often the clock 'ticks'.";
var() noexport int UpdateSeconds "How many seconds you want to have passed every update. This only works when using TimeOverride. This is only allowed to be a positive value.";

function bool VerifySelf()
{
	UpdateSeconds = int(__NFUN_211__(float(UpdateSeconds)));
	return super(Actor).VerifySelf();
	return;
}

function PostVerifySelf()
{
	super(dnDecoration).PostVerifySelf();
	StartTicking();
	return;
}

final function StartTicking()
{
	local float OrigUpdateRate;

	bPoweredOn = true;
	// End:0x1E
	if(__NFUN_145__(bTimeOverride))
	{
		TickStyle = 2;		
	}
	else
	{
		TickStyle = 3;
	}
	OrigUpdateRate = UpdateRate;
	UpdateRate = 0;
	ClockTick();
	UpdateRate = OrigUpdateRate;
	__NFUN_605__(UpdateRate, true, 'ClockTick');
	return;
}

final function StopTicking()
{
	bPoweredOn = false;
	TickStyle = default.TickStyle;
	__NFUN_606__('ClockTick');
	return;
}

function Destroyed()
{
	StopTicking();
	TriggerFunc_PowerOff();
	super(dnDecoration).Destroyed();
	return;
}

function SetTimeAtEMP()
{
	return;
}

function HitByEMP(optional float Duration, optional Pawn Instigator)
{
	bPoweredBeforeEMP = bPoweredOn;
	super.HitByEMP(Duration, Instigator);
	// End:0x3C
	if(__NFUN_145__(bTimeOverride))
	{
		bTimeOverride = true;
		SetTimeAtEMP();
		UpdateClock();
	}
	return;
}

function ForcePowerOn()
{
	super.ForcePowerOn();
	StartTicking();
	return;
}

function ForcePowerOff()
{
	super.ForcePowerOff();
	StopTicking();
	return;
}

function StartSelfOff()
{
	super(dnDecoration).StartSelfOff();
	bTimeOverride = true;
	return;
}

final function UpdateTimeOverride()
{
	__NFUN_180__(TimeOverride.Second, UpdateSeconds);
	// End:0x40
	if(__NFUN_172__(TimeOverride.Second, NumSeconds))
	{
		TimeOverride.Second = 0;
		__NFUN_184__(TimeOverride.Minute);		
	}
	else
	{
		// End:0x6C
		if(__NFUN_169__(TimeOverride.Second, 0))
		{
			TimeOverride.Second = NumSeconds;
			__NFUN_185__(TimeOverride.Minute);
		}
	}
	// End:0x9B
	if(__NFUN_172__(TimeOverride.Minute, NumMinutes))
	{
		TimeOverride.Minute = 0;
		__NFUN_184__(TimeOverride.Hour);		
	}
	else
	{
		// End:0xC7
		if(__NFUN_169__(TimeOverride.Minute, 0))
		{
			TimeOverride.Minute = NumMinutes;
			__NFUN_185__(TimeOverride.Hour);
		}
	}
	// End:0xEA
	if(__NFUN_172__(TimeOverride.Hour, NumHours))
	{
		TimeOverride.Hour = 0;		
	}
	else
	{
		// End:0x10A
		if(__NFUN_169__(TimeOverride.Hour, 0))
		{
			TimeOverride.Hour = NumHours;
		}
	}
	return;
}

final function ClockTick()
{
	// End:0x0F
	if(bTimeOverride)
	{
		UpdateTimeOverride();
	}
	UpdateClock();
	return;
}

final function UpdateClock()
{
	// End:0x33
	if(bTimeOverride)
	{
		UpdateTime(float(TimeOverride.Hour), float(TimeOverride.Minute), float(TimeOverride.Second));		
	}
	else
	{
		UpdateTime(float(Level.Hour), float(Level.Minute), float(Level.Second));
	}
	return;
}

final function UpdateTime(float Hour, float Minute, float Second)
{
	AdjustTime(Hour, Minute, Second);
	UpdateDisplay(Hour, Minute, Second);
	return;
}

function AdjustTime(out float Hour, out float Minute, out float Second)
{
	Hour = __NFUN_197__(Hour, float(NumHours));
	Minute = __NFUN_197__(Minute, float(NumMinutes));
	Second = __NFUN_197__(Second, float(NumSeconds));
	return;
}

function UpdateDisplay(float ClockHour, float ClockMinute, float ClockSecond)
{
	return;
}

defaultproperties
{
	bPoweredOn=true
	NumHours=12
	NumMinutes=60
	NumSeconds=60
	UpdateRate=1
	UpdateSeconds=1
	bSurviveDeath=true
	DestroyedActivities(0)=none
	DestroyedActivities(1)=DecoActivities_Sound'Electronics_Generic.DA_Sound_Destroyed_Electronic'
	DestroyedActivities(2)='dnGame.DecoActivityDeclarations.DA_Ticking_TICK_Never'
	HealthPrefab=1
	EMPDisableTime=5
}